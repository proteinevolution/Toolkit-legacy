#include <iostream>   // cin, cout, cerr
#include <fstream>    // ofstream, ifstream 
#include <stdio.h>    // printf
#include <stdlib.h>   // exit
#include <string>     // strcmp, strstr
#include <math.h>     // sqrt, pow
#include <limits.h>   // INT_MIN
#include <float.h>    // FLT_MIN

using std::cout;
using std::cerr;
using std::endl;
using std::ios;
using std::ifstream;
using std::ofstream;

const float f[]={7.68,5.14,4.02,5.41,1.89,3.27,5.99,7.56,3.69,5.06,10.01,5.97,2.20,3.50,4.54,4.67,7.12,1.25,3.95,7.28,0.0};
const float Gonnet[]=
{
//A    R    N    D    C    Q    E    G    H    I    L    K    M    F    P    S    T    W    Y    V    X     
 2.4,-0.6,-0.3,-0.3, 0.5,-0.2, 0.0, 0.5,-0.8,-0.8,-1.2,-0.4,-0.7,-2.3, 0.3, 1.1, 0.6,-3.6,-2.2, 0.1, 0.0,// A
-0.6, 4.7, 0.3,-0.3,-2.2, 1.5, 0.4,-1.0, 0.6,-2.4,-2.2, 2.7,-1.7,-3.2,-0.9,-0.2,-0.2,-1.6,-1.8,-2.0, 0.0,// R
-0.3, 0.3, 3.8, 2.2,-1.8, 0.7, 0.9, 0.4, 1.2,-2.8,-3.0, 0.8,-2.2,-3.1,-0.9, 0.9, 0.5,-3.6,-1.4,-2.2, 0.0,// N
-0.3,-0.3, 2.2, 4.7,-3.2, 0.9, 2.7, 0.1, 0.4,-3.8,-4.0, 0.5,-3.0,-4.5,-0.7, 0.5, 0.0,-5.2,-2.8,-2.9, 0.0,// D
 0.5,-2.2,-1.8,-3.2,11.5,-2.4,-3.0,-2.0,-1.3,-1.1,-1.5,-2.8,-0.9,-0.8,-3.1, 0.1,-0.5,-1.0,-0.5, 0.0, 0.0,// C
-0.2, 1.5, 0.7, 0.9,-2.4, 2.7, 1.7,-1.0, 1.2,-1.9,-1.6, 1.5,-1.0,-2.6,-0.2, 0.2, 0.0,-2.7,-1.7,-1.5, 0.0,// Q
 0.0, 0.4, 0.9, 2.7,-3.0, 1.7, 3.6,-0.8, 0.4,-2.7,-2.8, 1.2,-2.0,-3.9,-0.5, 0.2,-0.1,-4.3,-2.7,-1.9, 0.0,// E
 0.5,-1.0, 0.4, 0.1,-2.0,-1.0,-0.8, 6.6,-1.4,-4.5,-4.4,-1.1,-3.5,-5.2,-1.6, 0.4,-1.1,-4.0,-4.0,-3.3, 0.0,// G
-0.8, 0.6, 1.2, 0.4,-1.3, 1.2, 0.4,-1.4, 6.0,-2.2,-1.9, 0.6,-1.3,-0.1,-1.1,-0.2,-0.3,-0.8,-2.2,-2.0, 0.0,// H
-0.8,-2.4,-2.8,-3.8,-1.1,-1.9,-2.7,-4.5,-2.2, 4.0, 2.8,-2.1, 2.5, 1.0,-2.6,-1.8,-0.6,-1.8,-0.7, 3.1, 0.0,// I
-1.2,-2.2,-3.0,-4.0,-1.5,-1.6,-2.8,-4.4,-1.9, 2.8, 4.0,-2.1, 2.8, 2.0,-2.3,-2.1,-1.3,-0.7, 0.0, 1.8, 0.0,// L
-0.4, 2.7, 0.8, 0.5,-2.8, 1.5, 1.2,-1.1, 0.6,-2.1,-2.1, 3.2,-1.4,-3.3,-0.6, 0.1, 0.1,-3.5,-2.1,-1.7, 0.0,// K
-0.7,-1.7,-2.2,-3.0,-0.9,-1.0,-2.0,-3.5,-1.3, 2.5, 2.8,-1.4, 4.3, 1.6,-2.4,-1.4,-0.6,-1.0,-0.2, 1.6, 0.0,// M
-2.3,-3.2,-3.1,-4.5,-0.8,-2.6,-3.9,-5.2,-0.1, 1.0, 2.0,-3.3, 1.6, 7.0,-3.8,-2.8,-2.2, 3.6, 5.1, 0.1, 0.0,// F
 0.3,-0.9,-0.9,-0.7,-3.1,-0.2,-0.5,-1.6,-1.1,-2.6,-2.3,-0.6,-2.4,-3.8, 7.6, 0.4, 0.1,-5.0,-3.1,-1.8, 0.0,// P
 1.1,-0.2, 0.9, 0.5, 0.1, 0.2, 0.2, 0.4,-0.2,-1.8,-2.1, 0.1,-1.4,-2.8, 0.4, 2.2, 1.5,-3.3,-1.9,-1.0, 0.0,// S
 0.6,-0.2, 0.5, 0.0,-0.5, 0.0,-0.1,-1.1,-0.3,-0.6,-1.3, 0.1,-0.6,-2.2, 0.1, 1.5, 2.5,-3.5,-1.9, 0.0, 0.0,// T
-3.6,-1.6,-3.6,-5.2,-1.0,-2.7,-4.3,-4.0,-0.8,-1.8,-0.7,-3.5,-1.0, 3.6,-5.0,-3.3,-3.5,14.2, 4.1,-2.6, 0.0,// W
-2.2,-1.8,-1.4,-2.8,-0.5,-1.7,-2.7,-4.0,-2.2,-0.7, 0.0,-2.1,-0.2, 5.1,-3.1,-1.9,-1.9, 4.1, 7.8,-1.1, 0.0,// Y
 0.1,-2.0,-2.2,-2.9, 0.0,-1.5,-1.9,-3.3,-2.0, 3.1, 1.8,-1.7, 1.6, 0.1,-1.8,-1.0, 0.0,-2.6,-1.1, 3.4, 0.0,// V
 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 // X
};
float BLOSUM50[]=
  {
// A  R  N  D  C  Q  E  G  H  I  L  K  M  F  P  S  T  W  Y  V  X
   5,-2,-1,-2,-1,-1,-1, 0,-2,-1,-2,-1,-1,-3,-1, 1, 0,-3,-2, 0, 0, //A
  -2, 7,-1,-2,-4, 1, 0,-3, 0,-4,-3, 3,-2,-3,-3,-1,-1,-3,-1,-3, 0, //R
  -1,-1, 7, 2,-2, 0, 0, 0, 1,-3,-4, 0,-2,-4,-2, 1, 0,-4,-2,-3, 0, //N
  -2,-2, 2, 8,-4, 0, 2,-1,-1,-4,-4,-1,-4,-5,-1, 0,-1,-5,-3,-4, 0, //D
  -1,-4,-2,-4,13,-3,-3,-3,-3,-2,-2,-3,-2,-2,-4,-1,-1,-5,-3,-1, 0, //C
  -1, 1, 0, 0,-3, 7, 2,-2, 1,-3,-2, 2, 0,-4,-1, 0,-1,-1,-1,-3, 0, //Q
  -1, 0, 0, 2,-3, 2, 6,-3, 0,-4,-3, 1,-2,-3,-1,-1,-1,-3,-2,-3, 0, //E
   0,-3, 0,-1,-3,-2,-3, 8,-2,-4,-4,-2,-3,-4,-2, 0,-2,-3,-3,-4, 0, //G
  -2, 0, 1,-1,-3, 1, 0,-2,10,-4,-3, 0,-1,-1,-2,-1,-2,-3, 2,-4, 0, //H
  -1,-4,-3,-4,-2,-3,-4,-4,-4, 5, 2,-3, 2, 0,-3,-3,-1,-3,-1, 4, 0, //I
  -2,-3,-4,-4,-2,-2,-3,-4,-3, 2, 5,-3, 3, 1,-4,-3,-1,-2,-1, 1, 0, //L
  -1, 3, 0,-1,-3, 2, 1,-2, 0,-3,-3, 6,-2,-4,-1, 0,-1,-3,-2,-3, 0, //K
  -1,-2,-2,-4,-2, 0,-2,-3,-1, 2, 3,-2, 7, 0,-3,-2,-1,-1, 0, 1, 0, //M
  -3,-3,-4,-5,-2,-4,-3,-4,-1, 0, 1,-4, 0, 8,-4,-3,-2, 1, 4,-1, 0, //F
  -1,-3,-2,-1,-4,-1,-1,-2,-2,-3,-4,-1,-3,-4,10,-1,-1,-4,-3,-3, 0, //P
   1,-1, 1, 0,-1, 0,-1, 0,-1,-3,-3, 0,-2,-3,-1, 5, 2,-4,-2,-2, 0, //S
   0,-1, 0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1, 2, 5,-3,-2, 0, 0, //T
  -3,-3,-4,-5,-5,-1,-3,-3,-3,-3,-2,-3,-1, 1,-4,-4,-3,15, 2,-3, 0, //W
  -2,-1,-2,-3,-3,-1,-2,-3, 2,-1,-1,-2, 0, 4,-3,-2,-2, 2, 8,-1, 0, //Y
   0,-3,-3,-4,-1,-3,-3,-4,-4, 4, 1,-3, 1,-1,-3,-2, 0,-3,-1, 5, 0, //V
   0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0  //X 
 };

float BLOSUM62[]=
  {
// A  R  N  D  C  Q  E  G  H  I  L  K  M  F  P  S  T  W  Y  V  X
   4,-1,-2,-2, 0,-1,-1, 0,-2,-1,-1,-1,-1,-2,-1, 1, 0,-3,-2, 0, 0,  
  -1, 5, 0,-2,-3, 1, 0,-2, 0,-3,-2, 2,-1,-3,-2,-1,-1,-3,-2,-3,-1, 
  -2, 0, 6, 1,-3, 0, 0, 0, 1,-3,-3, 0,-2,-3,-2, 1, 0,-4,-2,-3,-1, 
  -2,-2, 1, 6,-3, 0, 2,-1,-1,-3,-4,-1,-3,-3,-1, 0,-1,-4,-3,-3,-1, 
   0,-3,-3,-3, 9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-2, 
  -1, 1, 0, 0,-3, 5, 2,-2, 0,-3,-2, 1, 0,-3,-1, 0,-1,-2,-1,-2,-1, 
  -1, 0, 0, 2,-4, 2, 5,-2, 0,-3,-3, 1,-2,-3,-1, 0,-1,-3,-2,-2,-1, 
   0,-2, 0,-1,-3,-2,-2, 6,-2,-4,-4,-2,-3,-3,-2, 0,-2,-2,-3,-3,-1, 
  -2, 0, 1,-1,-3, 0, 0,-2, 8,-3,-3,-1,-2,-1,-2,-1,-2,-2, 2,-3,-1, 
  -1,-3,-3,-3,-1,-3,-3,-4,-3, 4, 2,-3, 1, 0,-3,-2,-1,-3,-1, 3,-1, 
  -1,-2,-3,-4,-1,-2,-3,-4,-3, 2, 4,-2, 2, 0,-3,-2,-1,-2,-1, 1,-1, 
  -1, 2, 0,-1,-3, 1, 1,-2,-1,-3,-2, 5,-1,-3,-1, 0,-1,-3,-2,-2,-1, 
  -1,-1,-2,-3,-1, 0,-2,-3,-2, 1, 2,-1, 5, 0,-2,-1,-1,-1,-1, 1,-1, 
  -2,-3,-3,-3,-2,-3,-3,-3,-1, 0, 0,-3, 0, 6,-4,-2,-2, 1, 3,-1,-1,
  -1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4, 7,-1,-1,-4,-3,-2,-2, 
   1,-1, 1, 0,-1, 0, 0, 0,-1,-2,-2, 0,-1,-2,-1, 4, 1,-3,-2,-2, 0, 
   0,-1, 0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1, 1, 5,-2,-2, 0, 0, 
  -3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1, 1,-4,-3,-2,11, 2,-3,-2, 
  -2,-2,-2,-3,-2,-1,-2,-3, 2,-1,-1,-2,-1, 3,-3,-2,-2, 2, 7,-1,-1, 
   0,-3,-3,-3,-1,-2,-2,-3,-3, 3, 1,-2, 1,-1,-2,-2, 0,-3,-1, 4,-1, 
   0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2, 0, 0,-2,-1,-1,-1  
};

float G[20][20];  // normalized Gonnet matrix
float H[20][20];  // normalized Gonnet matrix


/////////////////////////////////////////////////////////////////////////////////////
// Transforms integers between 0 and 22 into the one-letter amino acid code
/////////////////////////////////////////////////////////////////////////////////////
inline char i2aa(char c)
{
  //A  R  N  D  C  Q  E  G  H  I  L  K  M  F  P  S  T  W  Y  V
  switch (c)
    {
    case 0: return 'A';
    case 1: return 'R';
    case 2: return 'N';
    case 3: return 'D';
    case 4: return 'C';
    case 5: return 'Q';
    case 6: return 'E';
    case 7: return 'G';
    case 8: return 'H';
    case 9: return 'I';
    case 10: return 'L';
    case 11: return 'K';
    case 12: return 'M';
    case 13: return 'F';
    case 14: return 'P';
    case 15: return 'S';
    case 16: return 'T';
    case 17: return 'W';
    case 18: return 'Y';
    case 19: return 'V';
    }
  return '?';
}

void CalculateConservation(float p[])
{
  int a,b;
  float c=0;
  float E=0;
  float relE=0;

  for(a=0; a<20; a++) p[a]*=0.01;

  for(a=0; a<20; a++) 
    for(b=0; b<20; b++) 
      c+=p[a]*p[b]*G[a][b];

  for(a=0; a<20; a++) 
    E-=(p[a]? p[a]*log(p[a]):0);

  for(a=0; a<20; a++) 
    relE+=(p[a]? p[a]*log(p[a]/f[a]*100):0);
      
  printf("Freqs: ");
  for (a=0; a<20; a++) printf("%4.0f ",100*p[a]);
  printf(" => c^2=%4.2f  E=%4.2f  relE=%4.2f\n",c*c,E,relE);    
}

int main(int argc, char **argv)
{  
  //           A    R    N    D    C    Q    E    G    H    I    L    K    M    F    P    S    T    W    Y    V    X     
  float f1[]={5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,5.0 ,0.0};
  float f2[]={7.68,5.14,4.02,5.41,1.89,3.27,5.99,7.56,3.69,5.06,10.0,5.97,2.20,3.50,4.54,4.67,7.12,1.25,3.95,7.28,0.0};

  float p1[]={0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,100 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0};
  float p2[]={0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,80.0,0.0 ,0.0 ,0.0 ,20.0,0.0 ,0.0 ,0.0};
  float p3[]={0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,20.0,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,80.0,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0};
  float p4[]={0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,50.0,0.0 ,0.0 ,0.0 ,50.0,0.0 ,0.0 ,0.0};
  float p5[]={0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,50.0,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,50.0,0.0};

  float q1[]={0.0 ,0.0 ,0.0 ,100.,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0};
  float q2[]={0.0 ,0.0 ,0.0 ,90.0,0.0 ,0.0 ,10.0,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0};
  float q3[]={0.0 ,0.0 ,0.0 ,50.0,0.0 ,0.0 ,50.0,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0};
  float q4[]={0.0 ,0.0 ,0.0 ,90.0,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,10.0,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0};
  float q5[]={0.0 ,0.0 ,0.0 ,50.0,0.0 ,0.0 ,40.0,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,10.0,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0};
  float q6[]={0.0 ,0.0 ,0.0 ,50.0,0.0 ,0.0 ,30.0,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,20.0,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0};
  float q7[]={0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,40.0,40.0,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,20.0,0.0};
  float q8[]={0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,40.0,20.0,0.0 ,40.0,0.0 ,0.0 ,0.0};
  float q9[]={10.0,10.0,10.0,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,10.0,0.0 ,10.0,10.0,0.0 ,0.0 ,10.0,0.0 ,10.0,0.0 ,10.0,10.0,0.0};

  float r1[]={0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,17.8,82.2,0.0, 0.0 ,0.0 ,0.0 ,0.0 ,0.0 ,0.0};

  int a,b;
  float offset=0.0;
  for(a=0; a<20; a++) 
    for(b=0; b<20; b++)
//      G[a][b]=(BLOSUM62[a*21+b]+offset)/sqrt((BLOSUM62[a*21+a]+offset)*(BLOSUM62[b*21+b]+offset)); 
      G[a][b]=(BLOSUM50[a*21+b]+offset)/sqrt((BLOSUM50[a*21+a]+offset)*(BLOSUM50[b*21+b]+offset)); 
//      G[a][b]=(Gonnet[a*21+b]+offset)/sqrt((Gonnet[a*21+a]+offset)*(Gonnet[b*21+b]+offset));

  cout<<endl<<"\nRescaled substitution matrix G(a,b)\n";
  cout<<"          A    R    N    D    C    Q    E    G    H    I    L    K    M    F    P    S    T    W    Y    V\n";
  for (a=0; a<20; a++)
    {
      cout<<i2aa(a)<<"       ";
      for (b=0; b<20; b++)  fprintf(stdout,"%4.1f ",G[a][b]);
      cout<<endl;
    }
  cout<<endl;



  printf("          A    R    N    D    C    Q    E    G    H    I    L    K    M    F    P    S    T    W    Y    V \n");
  CalculateConservation(f1);
  CalculateConservation(f2);
  printf("\n");

  printf("          A    R    N    D    C    Q    E    G    H    I    L    K    M    F    P    S    T    W    Y    V \n");
  CalculateConservation(p1);
  CalculateConservation(p2);
  CalculateConservation(p3);
  CalculateConservation(p4);
  CalculateConservation(p5);
  printf("\n");

  printf("          A    R    N    D    C    Q    E    G    H    I    L    K    M    F    P    S    T    W    Y    V \n");
  CalculateConservation(q1);
  CalculateConservation(q2);
  CalculateConservation(q3);
  CalculateConservation(q4);
  CalculateConservation(q5);
  CalculateConservation(q6);
  CalculateConservation(q7);
  CalculateConservation(q8);
  CalculateConservation(q9);
  printf("\n");

  printf("          A    R    N    D    C    Q    E    G    H    I    L    K    M    F    P    S    T    W    Y    V \n");
  CalculateConservation(r1);
  printf("\n");

  exit(0);
}
